{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>🌺 Create Your Blend</title>

   <!-- Fonts -->
   
    <!-- Fonts (중복 제거 후 단일 링크 유지) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Alkatra:wght@400..700&family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap" rel="stylesheet">

		
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="{% static 'c2/assets/css/main.css' %}" />
		<noscript><link rel="stylesheet" href="{% static 'c2/assets/css/noscript.css' %}" /></noscript>

    
    
  <style>
    body {
      font-family: 'Playfair Display', serif;
      margin: 0;
      background-color: #fdfcf8;
    }

    /* #ingredient-list 다음에 오는 버튼 래퍼 div */
    #custom-blend > div:nth-of-type(2){
      display: flex;
      justify-content: center;
    }

    section#custom-blend {
      max-width: 1000px;
      margin: 4em auto;
      padding: 2em;
      background-color: #ffffff;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      font-family: 'Alkatra', sans-serif;
      align-items: center;
    }

    h2, p {
      text-align: center;
    }

    #ingredient-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 1.2em;
      margin-top: 2em;
    }

    .ingredient-card {
      border: 2px solid #ddd;
      border-radius: 12px;
      overflow: hidden;
      cursor: pointer;
      transition: transform 0.2s ease, border-color 0.3s ease;
      position: relative;
    }

    .ingredient-card.selected {
      border-color: #ffa500;
    }

    .ingredient-card img {
      width: 100%;
      height: 140px;
      object-fit: cover;
    }

    .ingredient-card .content {
      padding: 1em;
    }

    .ingredient-card h4 {
      margin: 0 0 0.5em;
    }

    .ingredient-card .blend-label {
      position: absolute;
      top: 8px;
      left: 8px;
      background-color: #ffa500;
      color: white;
      padding: 0.3em 0.8em;
      border-radius: 20px;
      font-size: 0.8em;
      display: none;
    }

    .ingredient-card.selected .blend-label {
      display: inline-block;
    }

    .new-ingredient {
      position: relative;
    }

    .new-ingredient::after {
      content: "NEW!";
      position: absolute;
      top: 8px;
      right: 8px;
      background: linear-gradient(45deg, #ff6b6b, #ffa500);
      color: white;
      padding: 0.3em 0.6em;
      border-radius: 12px;
      font-size: 0.7em;
      font-weight: bold;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    #blend-name-input {
      margin-top: 2em;
      text-align: center;
    }

    #blend-name-input input {
      padding: 0.7em;
      width: 70%;
      border-radius: 10px;
      border: 1px solid #ccc;
      font-family: 'Playfair Display', serif;
    }

    button {
      margin-top: 1.5em;
      padding: 1em 2em;
      background-color: #ffa500;
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 1.1em;
      cursor: pointer;
      font-family: 'Alkatra', cursive;
    }

    #blend-result {
      text-align: center;
      margin-top: 2.5em;
    }

/* ===== Section 컨테이너: 완전 반응형 ===== */
#custom-blend{
  width: min(1000px, 92vw);                        /* 데스크탑에선 1000px, 모바일에선 화면폭 */
  margin: clamp(24px, 6vw, 64px) auto;             /* 위아래 마진 유동 */
  padding: clamp(16px, 3vw, 32px);                 /* 패딩 유동 */
  border-radius: clamp(10px, 1.8vw, 16px);         /* 둥근 모서리 유동 */
  background: #fff;
  box-shadow: 0 4px 12px rgba(0,0,0,.1);
}

/* 제목/설명도 유동 타이포 */
#custom-blend h2{
  text-align: center;
  font-size: clamp(22px, 3.2vw, 34px);
  margin: 0 0 clamp(8px, 1.6vw, 12px);
}
#custom-blend > p{
  text-align: center;
  font-size: clamp(14px, 1.8vw, 18px);
  line-height: 1.6;
  margin: 0;
}

/* ===== 그리드: 기본 4열 → 화면 줄면 자동 ↓ ===== */
#ingredient-list{
  display: grid;
  gap: clamp(12px, 2.5vw, 20px);
  grid-template-columns: repeat(4, minmax(0, 1fr)); /* 기본 4열 */
  margin-top: clamp(16px, 3vw, 24px);
}
@media (max-width: 1024px){
  #ingredient-list{ grid-template-columns: repeat(3, minmax(0,1fr)); } /* 3열 */
}
@media (max-width: 720px){
  #ingredient-list{ grid-template-columns: repeat(2, minmax(0,1fr)); } /* 2열 */
}
/* 필요 시 480px 이하에서 3열 강제하려면 아래 주석 해제
@media (max-width: 480px){
  #ingredient-list{ grid-template-columns: repeat(3, minmax(0,1fr)); }
}
*/

/* 카드와 이미지도 유동 크기 */
.ingredient-card{
  border: 2px solid #ddd;
  border-radius: 12px;
  overflow: hidden;
  cursor: pointer;
  transition: transform .2s ease, border-color .3s ease;
  position: relative;
}
.ingredient-card img{
  width: 100%;
  height: clamp(110px, 22vw, 160px);  /* 뷰포트에 따라 이미지 높이 유동 */
  object-fit: cover;
}
.ingredient-card .content{ padding: clamp(10px, 2.2vw, 16px); }
.ingredient-card h4{
  margin: 0 0 .5em;
  font-size: clamp(14px, 1.4vw, 18px);
  line-height: 1.25;
}
.ingredient-card p{
  font-size: clamp(12px, 1.2vw, 16px);
  line-height: 1.55;
}

/* 작은 화면에서 설명 2줄로 고정(레이아웃 안정화) */
@media (max-width: 720px){
  .ingredient-card p{
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 2;
    overflow: hidden;
  }
}

/* 선택 라벨 */
.ingredient-card .blend-label{
  position: absolute; top: 8px; left: 8px;
  background: #ffa500; color: #fff;
  padding: .3em .8em; border-radius: 20px;
  font-size: clamp(11px, 1.1vw, 13px);
  display: none;
}
.ingredient-card.selected{ border-color: #ffa500; }
.ingredient-card.selected .blend-label{ display: inline-block; }

/* 버튼 중앙 정렬(마크업에 .btn-row 있으면 이게 우선) */
#custom-blend .btn-row{ display:flex; justify-content:center; }
button{
  margin-top: 1.2em;
  padding: clamp(10px, 2vw, 16px) clamp(16px, 4vw, 28px);
  background:#ffa500; color:#fff; border:0; border-radius:12px;
  font-size: clamp(14px, 1.4vw, 18px);
  cursor:pointer;
}
/* .btn-row가 없다면 기존 div를 대상으로 폴백 센터링 */
#custom-blend > div:nth-of-type(2){ display:flex; justify-content:center; }
/* 모바일에선 버튼 폭도 유동 */
@media (max-width: 480px){
  button{ width:100%; max-width: 340px; }
}

/* 결과 이미지도 반응형 */
#blend-result{ text-align:center; margin-top: clamp(20px, 4vw, 40px); }
#blend-result img{
  max-width: min(300px, 80vw);
  width: 100%;
  height: auto;
  border-radius: 12px;
}

  </style>
</head>

<body>
  
  <!-- Nav -->
						<nav id="nav" style="font-family: 'Alkatra', sans-serif; font-weight: bold;">
							<ul>
								<li><a href="/">Home</a></li>
								<li>
									<a href="/order">Order</a>
									
								</li>
								<li><a href="/info">About Jamu</a></li>
								<li><a href="/ourstory">Story Behind Mendjamoo</a></li>
								<li><a href="#">Language</a>
									<ul>
										<li style="font-family: Alkatra;"><a href="/CreateYourBlend">English</a></li>
										<li style="font-family: Alkatra;"><a href="/CreateYourBlend_ind">Bahasa Indonesia</a></li>
										<li style="font-family: Alkatra;"><a href="/CreateYourBlend_kor">한국어</a></li>
									</ul>
								</li>
							</ul>
						</nav>

  <!-- Create Your Blend Section -->
   <br><br><br><br>

   <h2 style="font-family: 'Alkatra', sans-serif;">🌺 Create Your Blend</h2>
    <p style="font-family: 'Alkatra', sans-serif;">Choose your favorite Jamu ingredients and name your own travel-inspired blend.<br>

  <section id="custom-blend">

    <div id="ingredient-list"></div>

    <div>
      <button onclick="createBlend()">Create Your Jamu</button>
    </div>

    <div id="blend-result"></div>
  </section>

  <script style="font-family: 'Playfair Display', serif;">
    const ingredients = [
      // 기존 10개 재료
      { name: "Turmeric", desc: "Anti-inflammatory and antioxidant.", img: "{% static 'c2/images/Turmeric.png' %}", isNew: false },
      { name: "Ginger", desc: "Cold relief and digestive aid.", img: "{% static 'c2/images/ginger.jpg' %}", isNew: false },
      { name: "Galangal", desc: "Relieves cough and body aches.", img: "{% static 'c2/images/Galangal.jpg' %}", isNew: false },
      { name: "Tamarind", desc: "Sourness & digestive help.", img: "{% static 'c2/images/Tamarind.jpg' %}", isNew: false },
      { name: "Temulawak", desc: "Liver and immunity support.", img: "{% static 'c2/images/Temulawak_low.jpg' %}", isNew: false },
      { name: "Palm Sugar", desc: "Natural sweetness & minerals.", img: "{% static 'c2/images/PalmSugar.png' %}", isNew: false },
      { name: "Lime", desc: "Vitamin C & freshness.", img: "{% static 'c2/images/Lime.jpg' %}", isNew: false },
      { name: "Lemongrass", desc: "Aroma and digestion benefits.", img: "{% static 'c2/images/Lemongrass.jpg' %}", isNew: false },
      { name: "Cinnamon", desc: "Regulates sugar, adds warmth.", img: "{% static 'c2/images/Cinnamon.jpg' %}", isNew: false },
      { name: "Cardamom", desc: "Digestive spice with rich aroma.", img: "{% static 'c2/images/Cardamom.jpg' %}", isNew: false },
      
      // 새로 추가되는 5개 재료
      { name: "Cloves", desc: "Antibacterial, oral health & digestion.", img: "{% static 'c2/images/Cloves.jpg' %}", isNew: false },
      { name: "Sappan Wood", desc: "Blood circulation & antioxidant.", img: "{% static 'c2/images/SappanWood.jpg' %}", isNew: false },
      { name: "Black Cumin", desc: "Immunity boost & respiratory health.", img: "{% static 'c2/images/BlackCumin.jpg' %}", isNew: false },
      { name: "Black Turmeric", desc: "Blood purification & cholesterol control.", img: "{% static 'c2/images/BlackTurmeric.jpg' %}", isNew: false },
      { name: "Bay Leaves", desc: "Blood sugar control & digestion aid.", img: "{% static 'c2/images/BayLeaves.jpg' %}", isNew: false }
    ];

    const selected = [];

    function renderIngredients() {
      const container = document.getElementById("ingredient-list");
      container.innerHTML = "";
      ingredients.forEach((item, index) => {
        const card = document.createElement("div");
        card.className = `ingredient-card ${item.isNew ? 'new-ingredient' : ''}`;
        card.setAttribute("data-name", item.name);
        card.innerHTML = `
          <div class="blend-label">${item.name}</div>
          <img src="${item.img}" alt="${item.name}" onerror="this.src='{% static 'c2/images/default-ingredient.jpg' %}'">
          <div class="content">
            <h4>${item.name}</h4>
            <p>${item.desc}</p>
          </div>
        `;
        card.addEventListener("click", () => toggleIngredient(item.name, card));
        container.appendChild(card);
      });
    }

    function toggleIngredient(name, card) {
      const index = selected.indexOf(name);
      if (index > -1) {
        selected.splice(index, 1);
        card.classList.remove("selected");
      } else {
        if (selected.length >= 7) {
          alert("You can select up to 7 ingredients for the perfect blend! 🌿");
          return;
        }
        selected.push(name);
        card.classList.add("selected");
      }
    }

    // 선택된 재료에 따른 자무 타입과 이미지 결정
    function determineJamuType(selectedIngredients) {
      const ingredients = selectedIngredients.map(name => name.toLowerCase());
      
      // 각 자무 타입별 주요 재료들 정의
      const jamuTypes = {
        'kunyit-asem': {
          keywords: ['turmeric', 'tamarind', 'lime'],
          image: "{% static 'c2/images/KunyitAsem.png' %}",
          name: 'Kunyit Asam Style',
          description: 'Golden turmeric blend with refreshing sourness',
          color: '#FF8C00'
        },
        'temulawak': {
          keywords: ['temulawak', 'bay leaves'],
          image: "{% static 'c2/images/Temulawak.jpg' %}",
          name: 'Temulawak Blend',
          description: 'Liver-supporting Javanese turmeric blend',
          color: '#DAA520'
        },
        'temu-ireng': {
          keywords: ['black turmeric', 'black cumin', 'sappan wood'],
          image: "{% static 'c2/images/TemuIreng.jpg' %}",
          name: 'Black Turmeric Blend',
          description: 'Rare black turmeric for blood purification',
          color: '#B22222'
        },
        'wedang-uwuh': {
          keywords: ['cinnamon', 'cardamom', 'cloves', 'sappan wood', 'lemongrass'],
          image: "{% static 'c2/images/WedangUwuh.jpg' %}",
          name: 'Warm Spice Blend',
          description: 'Traditional warming spices for circulation',
          color: '#8B4513'
        },
        'empon-empon': {
          keywords: ['ginger', 'galangal', 'turmeric', 'temulawak'],
          image: "{% static 'c2/images/EmponEmpon.jpg' %}",
          name: 'Complete Herbal Blend',
          description: 'Comprehensive immunity-boosting blend',
          color: '#D2691E'
        },
        'fresh-blend': {
          keywords: ['lime', 'lemongrass', 'palm sugar'],
          image: "{% static 'c2/images/KunyitAsem.png' %}",
          name: 'Fresh Citrus Blend',
          description: 'Refreshing and energizing citrus blend',
          color: '#32CD32'
        }
      };

      // 점수 계산
      let scores = {};
      Object.keys(jamuTypes).forEach(type => {
        scores[type] = 0;
        jamuTypes[type].keywords.forEach(keyword => {
          if (ingredients.some(ingredient => ingredient.includes(keyword))) {
            scores[type] += 1;
          }
        });
      });

      // 가장 높은 점수의 타입 선택
      const bestType = Object.keys(scores).reduce((a, b) => 
        scores[a] > scores[b] ? a : b
      );

      // 점수가 0이면 기본 empon-empon 스타일
      if (scores[bestType] === 0) {
        return jamuTypes['empon-empon'];
      }

      return jamuTypes[bestType];
    }

    function createBlend() {
      const result = document.getElementById("blend-result");
      if (selected.length === 0) {
        result.innerHTML = `
          <div style="background: #ffe6e6; color: #d63031; padding: 1em; border-radius: 8px;">
            <p>🌿 Please select at least one ingredient to create your custom jamu!</p>
          </div>
        `;
        return;
      }

      // 선택된 재료 중 새로운 재료가 있는지 확인
      const newIngredients = selected.filter(name => 
        ingredients.find(ing => ing.name === name && ing.isNew)
      );
      
      const hasNewIngredients = newIngredients.length > 0;

      // 자무 타입 결정
      const jamuType = determineJamuType(selected);

      result.innerHTML = `
        <div style="background: linear-gradient(135deg, #fff9e6, #ffe8d1); padding: 2em; border-radius: 16px; border-left: 4px solid ${jamuType.color};">
          <h3>🌸 Your ${jamuType.name}</h3>
          <p style="color: #666; font-style: italic; margin: 0.5em 0 1.5em;">${jamuType.description}</p>
          
          <img src="${jamuType.image}" alt="${jamuType.name}" 
               style="max-width: 300px; width: 100%; border-radius: 12px; margin: 1em 0; box-shadow: 0 4px 8px rgba(0,0,0,0.1);" 
               onerror="this.src='{% static 'c2/images/jamuup.png' %}'" />
          
          <p style="font-size: 1.1em; margin: 1em 0;"><strong>Selected Ingredients (${selected.length}):</strong></p>
          <p style="background: #f8f8f8; padding: 1em; border-radius: 8px; font-weight: bold; color: #333;">
            ${selected.join(" • ")}
          </p>
          
          ${hasNewIngredients ? `
            <div style="background: #e8f5e8; color: #2d5a2d; padding: 1em; border-radius: 8px; margin: 1em 0;">
              <strong>✨ Special Blend!</strong> Your jamu includes ${newIngredients.length} new traditional ingredient${newIngredients.length > 1 ? 's' : ''}: 
              <strong>${newIngredients.join(", ")}</strong>
            </div>
          ` : ''}
          
          <div style="background: rgba(255,255,255,0.7); padding: 1em; border-radius: 8px; margin: 1em 0;">
            <h4 style="margin: 0 0 0.5em; color: ${jamuType.color};">🌿 Blend Profile:</h4>
            <p style="margin: 0; font-size: 0.95em;">This custom blend combines traditional Indonesian healing wisdom with your personal ingredient preferences, creating a unique jamu perfect for your travel wellness journey.</p>
          </div>
        
        </div>
      `;
    }

    function orderBlend() {
      alert("🌿 Thank you! Your custom jamu blend will be prepared with traditional Indonesian methods. Redirecting to order page...");
      // window.location.href = '/order';
    }

    function shareBlend() {
      const recipe = `My Custom Jamu Recipe: ${selected.join(", ")} - Perfect for travel wellness! 🌿✈️`;
      if (navigator.share) {
        navigator.share({
          title: 'My Custom Jamu Blend',
          text: recipe,
          url: window.location.href
        });
      } else {
        navigator.clipboard.writeText(recipe).then(() => {
          alert("Recipe copied to clipboard! Share with your friends! 📋✨");
        });
      }
    }

    renderIngredients();
      
  </script>

<!-- Scripts -->
			<script src="{% static 'c2/assets/js/jquery.min.js' %}"></script>
			<script src="{% static 'c2/assets/js/jquery.dropotron.min.js' %}"></script>
			<script src="{% static 'c2/assets/js/jquery.scrolly.min.js' %}"></script>
			<script src="{% static 'c2/assets/js/jquery.scrollex.min.js' %}"></script>
			<script src="{% static 'c2/assets/js/browser.min.js' %}"></script>
			<script src="{% static 'c2/assets/js/breakpoints.min.js' %}"></script>
			<script src="{% static 'c2/assets/js/util.js' %}"></script>
			<script src="{% static 'c2/assets/js/main.js' %}"></script>

</body>
</html>